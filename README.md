# Drunk & Dangerous Friends🍻
：我喝不 Shot 了！：（

## Concept Development 專案簡介

在現代聚會、派對、韓國遊戲文化中，「調酒」常作為懲罰或遊戲的一環，而過程中最麻煩的就是——要有人負責調，而且常常調錯、量不準、有爭議，也不夠公平，不夠科技感。
我們希望改善這點，打造一個：

***讓使用者透過網頁進行遊戲，由系統調製飲品的人機互動系統 ⭐***

## Implementation Resources 硬體資源

- raspberry pi4 x1
- MW明緯 LRS-50-12 電源供應器（AC→DC Power Supply） x1
- L289N 馬達驅動器 x2
- 幫浦 x4
- 塑膠管3米
- 杜邦線數條 (母母、公母線)
- 紅黑線3米
- 麵包版一塊(小的)
- 銲槍、焊錫
- AC電源線
- type c 充電線
- 角柱
- 紙箱2個 (一大一小)
- 棉花棒
- 膠帶
- 熱融槍
- 美工刀、剪刀
- 蠟筆
- 標籤紙

## Hardware architecture 硬體架構
硬體架構圖
<img width="927" height="717" alt="image" src="https://github.com/user-attachments/assets/318b7976-802f-4700-b935-6ae3e64e6f4a" />

硬體腳位對應
| 幫浦 | L298N（第一台） | L298N（第二台） | 樹莓派 GPIO（實體腳位） |
|------|----------------|----------------|-------------------------|
| 第一顆幫浦 | in1 | — | GPIO22 (Pin 15) |
|  | in2 | — | GPIO27 (Pin 13) |
| 第二顆幫浦 | in3 | — | GPIO17 (Pin 11) |
|  | in4 | — | GPIO4 (Pin 7) |
| 第三顆幫浦 | — | in1 | GPIO19 (Pin 35) |
|  | — | in2 | GPIO13 (Pin 33) |
| 第四顆幫浦 | — | in3 | GPIO6 (Pin 31) |
|  | — | in4 | GPIO5 (Pin 29) |

## Existing Library/Software 技術概覽
- Docker (Docker compose、image)
- GPIO
- 


<!-- Which libraries do you use while you implement the project -->
## System Architecture Diagram 系統流程圖
<img width="602" height="1169" alt="系統架構" src="https://github.com/user-attachments/assets/573f0fab-74ee-49c2-84d5-23cb1c38ae1e" />

## Functional Map 功能架構圖
<img width="881" height="1641" alt="功能架構" src="https://github.com/user-attachments/assets/3768df74-1e26-452c-aee1-b596c8fa9a71" />


## Implementation Process

我們的目的是建立一套「多人派對遊戲 × 自動調酒機」的整合系統。整體流程由玩家端裝置作為操作介面，透過同一個網段連線至樹莓派。樹莓派同時擔任遊戲伺服器（Game Server）與調酒控制模組（Drink Controller），接收玩家操作後進行遊戲邏輯判斷，再輸出對應的硬體控制指令。

在系統架構上，我們先完成網路連線與房間流程：第一位玩家加入房間、鎖上另一個房間、玩家輸入使用者名稱、等待人數到齊、由房主開始遊戲，並透過轉盤決定出手順序與開局設定。接著實作核心遊戲邏輯，以兩顆六面骰作為事件觸發依據，依據不同點數組合對應不同遊戲事件，並支援兩種模式：酒鬼模式（無積分、輸了直接喝、同一人累計喝三杯結束）與闔家歡模式（積分制、房內發生5次喝酒事件即結束）。

在硬體實作部分，樹莓派透過 GPIO 輸出控制訊號，連接至 L298N 馬達驅動多顆幫浦。每一顆幫浦對應到特定 GPIO 腳位與控制通道，系統會將遊戲結果轉換為「酒款（幫浦選擇）＋出酒時間（秒數）」等控制參數，並由控制模組執行倒酒動作。至此，我們完成了從玩家透過網頁互動、伺服器處理，到實體調酒輸出的完整閉環 ~！

## Knowledge from Lecture

- Raspberry Pi 環境設定

- Linux 腳本與程式設計

- Docker 包裝整個專案

## Installation 安裝
**需要連同一個網路**
教學初學者如何使用docker
從安裝開始
ㄗ再來如何匯入這個docker檔

首先要先安裝docker

```
final_project/
├── main.py               # FastAPI
├── game_logic.py 
├── pump_controller.py    # GPIO 控制程式
├── requirements.txt
├── Dockerfile
└── .dockerignore

```

<!-- How do the user install with your project? -->

## Usage 使用方法
1. 使用者在開始遊戲之前，事先連進與樹梅派同個網路(wifi)，利用自己的設備開啟瀏覽器，並輸入<<樹梅派的 IP:8000>>，進入遊戲首頁 
2. 進入到首頁後，玩家可以點選開始遊戲，並導入選擇模式介面。遊戲模式主要有兩種，一種是**闔家歡模式**，一種是**無乃酒鬼模式**，底下有兩種遊戲的差別。玩家可以從兩種模式中選擇其中一種遊玩。

  模式介紹
  | 項目 | 酒鬼模式 | 闔家歡模式 |
  |------|----------|------------|
  | 模式定位 | 派對刺激型 | 互動策略型 |
  | 是否使用積分 | 否 | 是 |
  | 積分計算方式 | 不適用 | 答對 +1、答錯 -1、未抽中 0 |
  | 回合計算方式 | 無回合 | 任一人觸發喝酒事件算一回合 |
  | 結束條件 | 任一玩家喝到 3 杯 | 進行5回合後結束 |

3. 當玩家進入遊戲選擇了其中一個模式，輸入名字，才能夠進入次模式。


第一位將會成為房主，(如果當前玩家退出，第二個進來的玩家將會自動成為房主)。並且會對另一模式進行上鎖

4. 其他玩家依序加入進行中的模式，需要 2 人(含)以上，房主才能夠選擇是否開始遊戲。在這個模式的房間內，最多只能容納 6 人遊玩。
(看要不要放圖片)
在房主按下開始遊戲前，如果有第 7 位玩家進入，該位玩家會被安排到排隊區(除非房間內的玩家主動退出，其餘等待的玩家才能夠進入房間)。否則若是在房主按下開始遊戲後，原先在排隊的玩家與剩餘想加入的玩家，則會進入觀戰模式，無法加入遊玩。
5.點選開始遊戲後，房主點選轉輪盤後，系統會自動轉輪盤抽取遊玩的順位，並自動轉至主要遊玩畫面。
6.依照順位結果，玩家可以在輪到自己時進行操作，其他玩家則觀看並等待。
玩家可以點上方的問號查看規則，進行遊玩的對照。以下是我們兩種模式的遊戲規則。

*闔家歡模式｜骰子規則對照表*

| 骰子點數（兩顆相加） | 對應組合 | 遊戲類型 | 規則說明 | 積分變化 | 是否使用幫浦 |幫浦運作秒數（s）|
|------------------|----------|----------|----------|----------|--------------|---------------|
| 3 | 1+2 | LSA 問答 | 手機顯示選擇題，玩家作答 | 對 +1 / 錯 -1 | 否 |
| 4 | 1+3 | 隨機酒 | 系統隨機指定一種酒 | 無 | 是 |
| 5 | 1+4、2+3 | LSA 問答 | 手機顯示選擇題 | 對 +1 / 錯 -1 | 否 |
| 6 | 1+5、2+4 | 黑白切 | 系統配對，勝負判定 | 贏 +1 / 輸 -1 | 否 |
| 7 | 1+6、3+4、2+5 | 自選酒 | 玩家自行選擇酒款與比例 | 無 | 是 |
| 8 | 2+6、3+5 | 隨機酒 | 系統隨機倒酒 | 無 | 是 |
| 9 | 3+6、4+5 | 喝喝 | 因懲罰過重，補償積分 | +1 | 否 |
| 對子 | 11、22、33、44、55、66 | 喝喝 | 補償事件 | +1 | 否 |
| 10、11 | 4+6、5+6 | 真心話大冒險 | 完成後可結束事件 | 無 | 否 |



*酒鬼模式｜骰子規則對照表*

| 骰子點數（兩顆相加） | 對應組合 | 遊戲類型 | 規則說明 | 是否使用幫浦 |幫浦運作秒數（s）|
|------------------|----------|----------|----------|--------------|---------------|
| 3 | 1+2 | 我有你沒有 | 系統隨機指定一人與擲骰者對戰，輸的人喝 | 否 |
| 4 | 1+3 | 隨機酒 | 系統隨機指定一種酒 | 是 |
| 5 | 1+4、2+3 | 掰手腕 | 系統隨機配對，輸的人喝 | 否 |
| 6 | 1+5、2+4 | 黑白切 | 系統隨機配對，輸的人喝 | 否 |
| 7 | 1+6、3+4、2+5 | 自選酒 | 擲骰者自行選擇酒款倒酒 | 是 |
| 8 | 2+6、3+5 | 隨機酒 | 系統隨機指定一種酒倒酒 | 是 |
| 9 | 3+6、4+5 | 射龍門 | 撲克牌遊戲，輸的人喝 | 否 |
| 對子 | 11、22、33、44、55、66 | 喝喝 | 無條件喝酒 | 否 |
| 10、11 | 4+6、5+6 | 真心話大冒險 | 完成挑戰，失敗者喝 | 否 |

7.在開局時，系統會先加入第一杯酒，準備開始遊玩，玩家依照順序，點選<<擲骰子的按鈕>>，根據骰子點數觸發對應的小遊戲或事件。(可以看上方規則)

8.遊戲過程全程以回合制進行，兩種模式有不同的結束方式，以下為兩種模式的結束條件。
| 遊戲模式 | 結束條件 |
| :--- | :--- |
| 闔家歡模式 | 每喝一次酒，就新增一回合，滿**5 個回合**後，遊戲結束並結算。 |
| 無乃酒鬼模式 | 當任一玩家累積喝滿 **3 杯**，遊戲立即結束。 |


## Difficulties 遇到的困難

- 在電源開啟狀態下，不小心將電源供應器與 L298N 馬達驅動器疊放接觸，造成瞬間短路產生火花，導致連接線燒斷，好險設備未受損。
- 在測試硬體設備時，第三台幫浦無法運作，排查後發現是線路未銜接好，調整後恢復了運作。
- 規格未定義清楚，所以做出的功能有所落差。
- 前期階段，前端和後端分開進行製作，導致在串接出現各種 Bug ，後續經過了一連串的測試和重新製作，得以正常運行。
- 系統整合好後未正確驅動對應的硬體設備，後來發現是前後端的傳送過程有誤。



## Vision for the future 未來展望

- 增強例外處理，如防止錯誤的人為操作。
- 彈性酒單設計，你的酒單你做主。
- 骰子小遊戲與規則豐富化，增加更多小遊戲。

  ✨🐧 happy ending ~！🍻🎉

## Job Assignment 分工表

| 組員 | 工作内容 |
|--------|------------|
| 張詠筑 | 主題發想、GPIO、硬體設計、遊戲規則設定|
| 郭又榛 | 主題發想、後端、遊戲規則設定 |
| 吳雅惠 | GPIO、簡報製作、外殼設計、遊戲規則設定 |
| 張廷伃 | 前端、簡報製作、撰寫 README 、遊戲規則設定|
| 莊佩諺 | 前端、外殼設計、撰寫 README 、遊戲規則設定|

## 花費
| 物品名稱 | 數量 | 價格 |
|---------|------|------|
| 水管 | 4m | 30 |
| 紅黑線 | 3米 | 30 |
| 幫浦 | 4個 | 400 |
| 供電器 | 1個 | 290 |
| 訊號器 | 2個 | 216 |
| 塑膠小杯 | 1袋 | 29 |
| 旋轉杯 | 4個 | 100 |
| 塑膠環保杯 | 5個 | 225 |
| 飲料 | 5瓶 | 199 |
| 雜項 | x | 14 |


## Acknowledgments 感謝名單

- BlueT
- Reg 學長
- Chat GPT
- Gemini
- Cloud code
- 蓬萊人偶

### 酒支援
- Reg
- BT(烈酒)
- 宣佑

## 客串名單
陳章銓、張峻碩、柏瑋學長

## References
