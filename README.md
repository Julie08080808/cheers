# é†‰åŠ æå‹ - äº’å‹•å¼æ™ºæ…§èª¿é…’ç³»çµ±

ä¸€å€‹çµåˆæ¨¹è“æ´¾ã€èª¿é…’æ©Ÿèˆ‡ LSA çŸ¥è­˜å•ç­”çš„äº’å‹•éŠæˆ²ç³»çµ±ã€‚

## æŠ€è¡“æ£§

- **å¾Œç«¯**: Python 3.11 + FastAPI + SQLAlchemy + SQLite
- **å‰ç«¯**: HTML5 + CSS3 + JavaScript (ES6+)
- **å¥—ä»¶ç®¡ç†**: uv
- **éƒ¨ç½²**: Docker + Docker Compose + NGINX
- **ç¡¬é«”**: Raspberry Pi + L298N Motor Driver + è •å‹•å¹«æµ¦

## å°ˆæ¡ˆçµæ§‹

```
cheers/
â”œâ”€â”€ backend/           # FastAPI å¾Œç«¯
â”‚   â”œâ”€â”€ main.py        # æ‡‰ç”¨å…¥å£
â”‚   â”œâ”€â”€ database.py    # è³‡æ–™åº«è¨­å®š
â”‚   â”œâ”€â”€ models/        # SQLAlchemy æ¨¡å‹
â”‚   â”œâ”€â”€ routers/       # API è·¯ç”±
â”‚   â”œâ”€â”€ schemas/       # Pydantic æ¨¡å¼
â”‚   â”œâ”€â”€ services/      # æ¥­å‹™é‚è¼¯
â”‚   â””â”€â”€ data/          # é¡Œåº« JSON æª”æ¡ˆ
â”œâ”€â”€ frontend/          # å‰ç«¯éœæ…‹æª”æ¡ˆ
â”œâ”€â”€ nginx/             # NGINX è¨­å®š
â”œâ”€â”€ docker-compose.yml # Docker Compose è¨­å®š
â”œâ”€â”€ dev-start.sh       # é–‹ç™¼ç’°å¢ƒå•Ÿå‹•è…³æœ¬
â”œâ”€â”€ dev-stop.sh        # é–‹ç™¼ç’°å¢ƒåœæ­¢è…³æœ¬
â”œâ”€â”€ dev-restart.sh     # é–‹ç™¼ç’°å¢ƒé‡å•Ÿè…³æœ¬
â””â”€â”€ dev-status.sh      # é–‹ç™¼ç’°å¢ƒç‹€æ…‹æª¢æŸ¥
```

## å¿«é€Ÿé–‹å§‹

### é–‹ç™¼ç’°å¢ƒ

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨é–‹ç™¼è…³æœ¬ï¼ˆæ¨è–¦ï¼‰

```bash
# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
./dev-start.sh

# åœæ­¢é–‹ç™¼ç’°å¢ƒ
./dev-stop.sh

# é‡å•Ÿé–‹ç™¼ç’°å¢ƒ
./dev-restart.sh

# æŸ¥çœ‹ç‹€æ…‹
./dev-status.sh

# åœæ­¢ä¸¦æ¸…ç†æ—¥èªŒ
./dev-stop.sh --clean-logs

# æŸ¥çœ‹å³æ™‚æ—¥èªŒ
tail -f backend.log
```

#### æ–¹æ³•äºŒï¼šæ‰‹å‹•å•Ÿå‹•

```bash
# å®‰è£ uv
curl -LsSf https://astral.sh/uv/install.sh | sh

# å®‰è£ä¾è³´
cd backend
uv sync

# å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨
uv run uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

è¨ªå•:
- API: http://localhost:8000
- API æ–‡ä»¶: http://localhost:8000/docs
- å‰ç«¯: é–‹å•Ÿ `frontend/index.html`

### ç”Ÿç”¢ç’°å¢ƒéƒ¨ç½²

#### ä½¿ç”¨ Docker Compose

```bash
# æ§‹å»ºä¸¦å•Ÿå‹•æ‰€æœ‰æœå‹™
docker-compose up -d --build

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f

# åœæ­¢æœå‹™
docker-compose down
```

è¨ªå• http://localhost é–‹å§‹éŠæˆ²

## é–‹ç™¼è…³æœ¬èªªæ˜

### dev-start.sh
è‡ªå‹•å•Ÿå‹•é–‹ç™¼ç’°å¢ƒï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- ğŸ” æª¢æŸ¥ä¸¦åœæ­¢èˆŠé€²ç¨‹
- ğŸ“¦ æª¢æŸ¥ä¾è³´å’Œè™›æ“¬ç’°å¢ƒ
- ğŸš€ å•Ÿå‹•å¾Œç«¯æœå‹™å™¨ï¼ˆèƒŒæ™¯é‹è¡Œï¼‰
- âœ… å¥åº·æª¢æŸ¥ï¼ˆæœ€å¤šé‡è©¦ 5 æ¬¡ï¼‰
- ğŸ“ è¨˜éŒ„ PID ä»¥ä¾¿ç®¡ç†

### dev-stop.sh
å®Œå…¨åœæ­¢é–‹ç™¼ç’°å¢ƒï¼ŒåŠŸèƒ½åŒ…æ‹¬ï¼š
- ğŸ¯ é€šé PID æª”æ¡ˆåœæ­¢é€²ç¨‹
- ğŸ§¹ æ¸…ç†éºç•™çš„ uvicorn é€²ç¨‹
- ğŸ”“ é‡‹æ”¾è¢«ä½”ç”¨çš„ç«¯å£ 8000
- ğŸ—‘ï¸ å¯é¸æ¸…ç†æ—¥èªŒï¼ˆ`--clean-logs`ï¼‰

### dev-restart.sh
ä¸€éµé‡å•Ÿé–‹ç™¼ç’°å¢ƒï¼š
- å…ˆåŸ·è¡Œ `dev-stop.sh`
- ç­‰å¾… 1 ç§’
- å†åŸ·è¡Œ `dev-start.sh`

### dev-status.sh
æŸ¥çœ‹é–‹ç™¼ç’°å¢ƒç‹€æ…‹ï¼š
- ğŸ“Š PID æª”æ¡ˆè³‡è¨Š
- ğŸ”Œ ç«¯å£ä½”ç”¨æƒ…æ³
- ğŸ’š API å¥åº·ç‹€æ…‹
- ğŸ“œ æœ€è¿‘ 10 è¡Œæ—¥èªŒ
- ğŸ” ç›¸é—œé€²ç¨‹åˆ—è¡¨

## API ç«¯é»

### éŠæˆ²ç®¡ç†
- `POST /api/game` - å‰µå»ºéŠæˆ²æˆ¿é–“
- `GET /api/game/{game_id}` - ç²å–éŠæˆ²ç‹€æ…‹
- `POST /api/game/{game_id}/start` - é–‹å§‹éŠæˆ²
- `POST /api/game/{game_id}/roll` - æ“²éª°å­
- `POST /api/game/{game_id}/next-turn` - ä¸‹ä¸€ä½ç©å®¶

### é¡Œåº« API
- `GET /api/questions/lsa/random` - éš¨æ©Ÿ LSA å•ç­”
- `GET /api/questions/truth/random` - éš¨æ©ŸçœŸå¿ƒè©±å¤§å†’éšª

### èª¿é…’æ©Ÿæ§åˆ¶
- `POST /api/drink/pour` - å€’é…’
- `GET /api/drink/status` - èª¿é…’æ©Ÿç‹€æ…‹

## éŠæˆ²æ¨¡å¼

### é—”å®¶æ­¡æ¨¡å¼ (Family Mode)
é©åˆå…¨å¹´é½¡çš„è¶£å‘³æ¨¡å¼ï¼ŒåŒ…å« LSA å•ç­”ã€é»‘ç™½åˆ‡ã€çœŸå¿ƒè©±å¤§å†’éšªç­‰äº‹ä»¶ã€‚

### é…’é¬¼æ¨¡å¼ (Alcoholic Mode)
æˆäººå‘é£²é…’éŠæˆ²æ¨¡å¼ï¼ŒåŒ…å«ã€Œæˆ‘æœ‰ä½ æ²’æœ‰ã€ã€å°„é¾é–€ç­‰äº‹ä»¶ã€‚

## ç¡¬é«”é…ç½®

### GPIO è…³ä½é…ç½®
| å¹«æµ¦ | IN1 | IN2 | é¡è‰² |
|------|-----|-----|------|
| 1 | GPIO 23 | GPIO 22 | ç´…è‰² |
| 2 | GPIO 27 | GPIO 17 | è—è‰² |
| 3 | GPIO 5 | GPIO 6 | é»ƒè‰² |

### æµé‡è¦æ ¼
- 1 ç§’ â‰ˆ 8ml

## é–‹ç™¼æŒ‡å—

### æ–°å¢é¡Œåº«
ç·¨è¼¯ `backend/data/questions_lsa.json` æˆ– `questions_truth.json`

### æ–°å¢é…æ–¹
åœ¨è³‡æ–™åº«ä¸­æ–°å¢ `Recipe` è¨˜éŒ„ï¼Œæˆ–ä¿®æ”¹ `pump_controller.py` çš„é è¨­é…æ–¹

### ä¿®æ”¹éŠæˆ²é‚è¼¯
ç·¨è¼¯ `backend/services/game_logic.py` çš„äº‹ä»¶å°ç…§è¡¨

### ç–‘é›£æ’è§£

**å•é¡Œï¼šç«¯å£ 8000 å·²è¢«ä½”ç”¨**
```bash
./dev-stop.sh  # æœƒè‡ªå‹•æ¸…ç†ç«¯å£ä½”ç”¨
```

**å•é¡Œï¼šé€²ç¨‹ç„¡æ³•åœæ­¢**
```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨åœæ­¢è…³æœ¬ï¼ˆæ¨è–¦ï¼‰
./dev-stop.sh

# æ–¹æ³• 2ï¼šæ‰‹å‹•æ¸…ç†
pkill -9 -f "uvicorn main:app"
lsof -ti:8000 | xargs kill -9
```

**å•é¡Œï¼šæŸ¥çœ‹è©³ç´°æ—¥èªŒ**
```bash
# å³æ™‚æ—¥èªŒ
tail -f backend.log

# å®Œæ•´æ—¥èªŒ
cat backend.log

# æœ€è¿‘éŒ¯èª¤
tail -n 50 backend.log | grep -i error
```

**å•é¡Œï¼šæª¢æŸ¥æœå‹™ç‹€æ…‹**
```bash
./dev-status.sh
```

## ç’°å¢ƒè®Šæ•¸

```bash
DATABASE_URL=sqlite:///./data/cheers.db  # è³‡æ–™åº«è·¯å¾‘
ENV=production                           # ç’°å¢ƒï¼ˆdevelopment/productionï¼‰
```

## æˆæ¬Š

æœ¬å°ˆæ¡ˆç‚ºå°ç£å¤§å­¸ Linux ç³»çµ±èˆ‡æ‡‰ç”¨ï¼ˆLSAï¼‰èª²ç¨‹æœŸæœ«å°ˆé¡Œã€‚

## è²¢ç»è€…

- å°ˆæ¡ˆä½œè€…: [Your Name]
- èª²ç¨‹: Linux ç³»çµ±èˆ‡æ‡‰ç”¨
- å­¸å¹´: 2024-2025
