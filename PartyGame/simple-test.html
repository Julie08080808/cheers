<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æˆ¿ä¸»åŠŸèƒ½ç°¡å–®æ¸¬è©¦</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #222; color: white; }
        button { padding: 15px 30px; margin: 10px; font-size: 18px; cursor: pointer;
                 background: #ff00cc; color: white; border: none; border-radius: 5px; }
        button:hover { background: #cc0099; }
        button:disabled { background: #666; cursor: not-allowed; }
        .box { background: #333; padding: 20px; margin: 20px 0; border-radius: 10px; }
        .info { color: #00ff00; font-family: monospace; white-space: pre-wrap; }
        .error { color: #ff0000; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æˆ¿ä¸»åŠŸèƒ½æ¸¬è©¦</h1>

    <div class="box">
        <h2>èªªæ˜ï¼š</h2>
        <p>é€™å€‹é é¢ç”¨ä¾†æ¸¬è©¦ã€Œæˆ¿ä¸»é–‹å§‹éŠæˆ²ã€çš„åŠŸèƒ½</p>
        <p>è«‹æŒ‰ç…§é †åºé»æ“ŠæŒ‰éˆ•ï¼ŒæŸ¥çœ‹çµæœ</p>
    </div>

    <div class="box">
        <h2>æ¸¬è©¦æ­¥é©Ÿï¼š</h2>

        <h3>1ï¸âƒ£ é‡ç½®æˆ¿é–“</h3>
        <button onclick="resetRoom()">é‡ç½®æˆ¿é–“</button>
        <div id="resetResult" class="info"></div>

        <h3>2ï¸âƒ£ ç©å®¶1åŠ å…¥ï¼ˆæˆç‚ºæˆ¿ä¸»ï¼‰</h3>
        <input type="text" id="name1" value="Alice" style="padding: 10px; font-size: 16px;">
        <button onclick="joinAsPlayer1()">ç©å®¶1åŠ å…¥</button>
        <div id="join1Result" class="info"></div>

        <h3>3ï¸âƒ£ ç©å®¶2åŠ å…¥</h3>
        <input type="text" id="name2" value="Bob" style="padding: 10px; font-size: 16px;">
        <button onclick="joinAsPlayer2()">ç©å®¶2åŠ å…¥</button>
        <div id="join2Result" class="info"></div>

        <h3>4ï¸âƒ£ æŸ¥çœ‹æˆ¿é–“ç‹€æ…‹</h3>
        <button onclick="checkRoomState()">æŸ¥çœ‹æˆ¿é–“ç‹€æ…‹</button>
        <div id="stateResult" class="info"></div>

        <h3>5ï¸âƒ£ æˆ¿ä¸»é–‹å§‹éŠæˆ²</h3>
        <button id="startBtn" onclick="startGameAsHost()" disabled>æˆ¿ä¸»é–‹å§‹éŠæˆ²</button>
        <div id="startResult" class="info"></div>
    </div>

    <script>
        let player1Id = null;
        let player2Id = null;

        async function resetRoom() {
            const result = document.getElementById('resetResult');
            result.textContent = 'è™•ç†ä¸­...';

            try {
                const res = await fetch('/api/room/reset', { method: 'POST' });
                const data = await res.json();

                if (res.ok) {
                    result.textContent = 'âœ… ' + JSON.stringify(data, null, 2);
                    player1Id = null;
                    player2Id = null;
                    document.getElementById('startBtn').disabled = true;
                } else {
                    result.className = 'error';
                    result.textContent = 'âŒ ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ éŒ¯èª¤: ' + error.message;
            }
        }

        async function joinAsPlayer1() {
            const result = document.getElementById('join1Result');
            const name = document.getElementById('name1').value;
            result.className = 'info';
            result.textContent = 'è™•ç†ä¸­...';

            try {
                const res = await fetch('/api/room/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_name: name })
                });
                const data = await res.json();

                if (res.ok) {
                    player1Id = data.player_id;
                    result.textContent = `âœ… æˆåŠŸåŠ å…¥ï¼
ç©å®¶ID: ${data.player_id}
æ˜¯å¦ç‚ºæˆ¿ä¸»: ${data.room_state.host_id === data.player_id}
ç›®å‰äººæ•¸: ${data.room_state.player_count}
å¯ä»¥é–‹å§‹: ${data.room_state.can_start}`;
                } else {
                    result.className = 'error';
                    result.textContent = 'âŒ ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ éŒ¯èª¤: ' + error.message;
            }
        }

        async function joinAsPlayer2() {
            const result = document.getElementById('join2Result');
            const name = document.getElementById('name2').value;
            result.className = 'info';
            result.textContent = 'è™•ç†ä¸­...';

            try {
                const res = await fetch('/api/room/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_name: name })
                });
                const data = await res.json();

                if (res.ok) {
                    player2Id = data.player_id;
                    result.textContent = `âœ… æˆåŠŸåŠ å…¥ï¼
ç©å®¶ID: ${data.player_id}
æ˜¯å¦ç‚ºæˆ¿ä¸»: ${data.room_state.host_id === data.player_id}
ç›®å‰äººæ•¸: ${data.room_state.player_count}
å¯ä»¥é–‹å§‹: ${data.room_state.can_start}`;

                    // å•Ÿç”¨é–‹å§‹éŠæˆ²æŒ‰éˆ•
                    if (player1Id && data.room_state.can_start) {
                        document.getElementById('startBtn').disabled = false;
                    }
                } else {
                    result.className = 'error';
                    result.textContent = 'âŒ ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ éŒ¯èª¤: ' + error.message;
            }
        }

        async function checkRoomState() {
            const result = document.getElementById('stateResult');
            result.className = 'info';
            result.textContent = 'è™•ç†ä¸­...';

            try {
                const res = await fetch('/api/room/state');
                const data = await res.json();

                if (res.ok) {
                    result.textContent = `âœ… æˆ¿é–“ç‹€æ…‹ï¼š
ç›®å‰äººæ•¸: ${data.player_count}
æˆ¿ä¸»ID: ${data.host_id}
å¯ä»¥é–‹å§‹: ${data.can_start}
éŠæˆ²å·²é–‹å§‹: ${data.game_started}

ç©å®¶åˆ—è¡¨:
${data.players.map((p, i) => `${i+1}. ${p.player_name} ${p.is_host ? 'ğŸ‘‘' : ''}`).join('\n')}`;
                } else {
                    result.className = 'error';
                    result.textContent = 'âŒ ' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ éŒ¯èª¤: ' + error.message;
            }
        }

        async function startGameAsHost() {
            const result = document.getElementById('startResult');
            result.className = 'info';
            result.textContent = 'è™•ç†ä¸­...';

            if (!player1Id) {
                result.className = 'error';
                result.textContent = 'âŒ è«‹å…ˆè®“ç©å®¶1åŠ å…¥';
                return;
            }

            try {
                const res = await fetch('/api/room/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_id: player1Id })
                });
                const data = await res.json();

                if (res.ok) {
                    result.textContent = `âœ… éŠæˆ²é–‹å§‹æˆåŠŸï¼

ç©å®¶é †åº:
${data.player_order.map(p => `${p.order}. ${p.player_name}`).join('\n')}

å®Œæ•´å›æ‡‰:
${JSON.stringify(data, null, 2)}`;
                } else {
                    result.className = 'error';
                    result.textContent = 'âŒ é–‹å§‹éŠæˆ²å¤±æ•—:\n' + JSON.stringify(data, null, 2);
                }
            } catch (error) {
                result.className = 'error';
                result.textContent = 'âŒ éŒ¯èª¤: ' + error.message;
            }
        }
    </script>
</body>
</html>
