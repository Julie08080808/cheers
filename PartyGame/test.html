<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ¿é–“åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 10px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background: #ff00cc;
            color: white;
        }
        button:hover {
            background: #cc0099;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #333;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
    </style>
</head>
<body>
    <h1>æˆ¿é–“åŠŸèƒ½æ¸¬è©¦é é¢</h1>

    <div class="test-section">
        <h2>æ­¥é©Ÿ 1: åŠ å…¥æˆ¿é–“</h2>
        <input type="text" id="playerName" placeholder="è¼¸å…¥ç©å®¶åç¨±" value="æ¸¬è©¦ç©å®¶1">
        <button onclick="testJoinRoom()">åŠ å…¥æˆ¿é–“</button>
        <div id="joinResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥é©Ÿ 2: æŸ¥çœ‹æˆ¿é–“ç‹€æ…‹</h2>
        <button onclick="testRoomState()">ç²å–æˆ¿é–“ç‹€æ…‹</button>
        <div id="stateResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥é©Ÿ 3: æˆ¿ä¸»é–‹å§‹éŠæˆ²</h2>
        <button onclick="testStartGame()">æˆ¿ä¸»é–‹å§‹éŠæˆ²</button>
        <div id="startResult" class="result"></div>
    </div>

    <div class="test-section">
        <h2>æ­¥é©Ÿ 4: é‡ç½®æˆ¿é–“</h2>
        <button onclick="testReset()">é‡ç½®æˆ¿é–“</button>
        <div id="resetResult" class="result"></div>
    </div>

    <script>
        let myPlayerId = null;

        async function testJoinRoom() {
            const playerName = document.getElementById('playerName').value;
            const resultDiv = document.getElementById('joinResult');
            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch('/api/room/join', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ player_name: playerName })
                });

                const data = await response.json();

                if (response.ok) {
                    myPlayerId = data.player_id;
                    resultDiv.innerHTML = `<span class="success">âœ… æˆåŠŸåŠ å…¥æˆ¿é–“</span>\nç©å®¶ID: ${data.player_id}\næ˜¯å¦ç‚ºæˆ¿ä¸»: ${data.room_state.host_id === data.player_id}\nç›®å‰äººæ•¸: ${data.room_state.player_count}\nå¯ä»¥é–‹å§‹: ${data.room_state.can_start}\n\nå®Œæ•´å›æ‡‰:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ åŠ å…¥å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ éŒ¯èª¤</span>\n${error.message}`;
            }
        }

        async function testRoomState() {
            const resultDiv = document.getElementById('stateResult');
            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch('/api/room/state', {
                    credentials: 'include'
                });

                const data = await response.json();

                resultDiv.innerHTML = `<span class="success">âœ… ç²å–æˆåŠŸ</span>\nç›®å‰äººæ•¸: ${data.player_count}\næˆ‘çš„ID: ${data.my_player_id}\næ˜¯å¦åœ¨æˆ¿é–“: ${data.is_in_room}\næ˜¯å¦ç‚ºæˆ¿ä¸»: ${data.is_host}\nå¯ä»¥é–‹å§‹: ${data.can_start}\n\nç©å®¶åˆ—è¡¨:\n${data.players.map((p, i) => `${i+1}. ${p.player_name} ${p.is_host ? 'ğŸ‘‘' : ''}`).join('\n')}\n\nå®Œæ•´å›æ‡‰:\n${JSON.stringify(data, null, 2)}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ éŒ¯èª¤</span>\n${error.message}`;
            }
        }

        async function testStartGame() {
            const resultDiv = document.getElementById('startResult');

            if (!myPlayerId) {
                resultDiv.innerHTML = '<span class="error">âŒ è«‹å…ˆåŠ å…¥æˆ¿é–“</span>';
                return;
            }

            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch('/api/room/start', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ player_id: myPlayerId })
                });

                const data = await response.json();

                if (response.ok) {
                    resultDiv.innerHTML = `<span class="success">âœ… éŠæˆ²é–‹å§‹æˆåŠŸ</span>\n\nç©å®¶é †åº:\n${data.player_order.map(p => `${p.order}. ${p.player_name}`).join('\n')}\n\nå®Œæ•´å›æ‡‰:\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é–‹å§‹å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ éŒ¯èª¤</span>\n${error.message}`;
            }
        }

        async function testReset() {
            const resultDiv = document.getElementById('resetResult');
            resultDiv.innerHTML = 'æ¸¬è©¦ä¸­...';

            try {
                const response = await fetch('/api/room/reset', {
                    method: 'POST'
                });

                const data = await response.json();

                if (response.ok) {
                    myPlayerId = null;
                    resultDiv.innerHTML = `<span class="success">âœ… æˆ¿é–“å·²é‡ç½®</span>\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.innerHTML = `<span class="error">âŒ é‡ç½®å¤±æ•—</span>\n${JSON.stringify(data, null, 2)}`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">âŒ éŒ¯èª¤</span>\n${error.message}`;
            }
        }
    </script>
</body>
</html>
